#!/usr/bin/env ruby -wKU

require 'highline'
require 'fileutils'
require 'fvm/extend/pathname'
require 'fvm/environment'

def shell
  @shell ||= HighLine.new
end

def here
  @here ||= Pathname.new( __FILE__ ).dirname
end

def home
  Fvm::Environment::FVM_HOME
end

def task( message, &block )
  shell.say "<%= color '#{message}', BOLD %>"
  shell.say 'Done' if block.call
end

task "Creating #{home}" do
  Dir.mkdir home unless home.exist?
  true
end

task "Copying install files" do
  FileUtils.cp_r here.join( '..', 'install', 'scripts' ), home.join( 'scripts' )
  true
end

# task "Making /usr/local/bin group writable" do
#   puts 'TODO!!'
# end

task "Add the following to the end of your ~/.bash_profile (or similar bash init file):" do
  restart = home.join( 'scripts', 'fvm' ).to_bash
  shell.say <<-EOS
  
    [[ -s "#{restart}" ]] && source "#{restart}"
    # This loads FVM into a shell session.
    
  EOS
  false
end